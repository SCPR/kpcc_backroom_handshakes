{% extends "newscast/_base.html" %}
{% load static %}
{% load humanize %}
{% load ballot_box_template_tags %}

{% block extra_css %}
    <link href="{% static 'css/general-election-reset.css' %}" media="screen" rel="stylesheet" type="text/css" />
    <link href="{% static 'css/general-election.css' %}" media="screen" rel="stylesheet" type="text/css" />
    <style type="text/css">
        .results h4 { font-size: 12px; text-align: right; margin-right: 2% }
        .results .measure-hack { min-height: 260px; }
        .results .results-block .dashboard-hack { -webkit-flex-wrap: wrap; flex-wrap: wrap; }
        .results .results-block .dashboard-hack .candidate-name { width: 73%; margin-left: 2% }
        .results .results-block .dashboard-hack .votepct { width: 24%; margin-right: 1% }
    </style>
{% endblock %}

{% block page_content %}
    <div class="hero-election dashboard">
        <div class="jumbotron text-center">
            <h1>{{ topic_contests.0.topicname }}</h1>
            <p>{{ topic_contests.0.description }}</p>
        </div>
        <div class="row-fluid results clearfix">
            {% for item in topic_contests %}
                {% for contest in item.contest.all %}
                    {% if contest.is_ballot_measure == False %}
                        <div class="results-block clearfix">
                            <header>
                                <h2 class="race-title">{{ contest.contestname|title }}</h2>
                                <h2 class="precincts-reporting">{{ contest.precinctsreportingpct|percentage|floatformat:0 }}% precincts reporting</h2>
                            </header>
                            {% for candidate in contest.candidate_set.all|slice:":2"|dictsortreversed:"votepct" %}
                                <div class="result-item clearfix">
                                    {% if contest.is_homepage_priority == True %}
                                        {% if baked == True %}
                                            <img src="http://162.243.135.6/static/assets/{{ candidate.candidateid }}.png" alt="{{ candidate.candidateid }}"/>
                                        {% else %}
                                            <img src="{% static '' %}/assets/{{ candidate.candidateid }}.png" alt="{{ candidate.candidateid }}"/>
                                        {% endif %}
                                    {% else %}
                                        <img src="{% static '' %}/assets/default_avatar.png" alt="{{ candidate.candidateid }}"/>
                                    {% endif %}
                                    <h3 class="candidate-name">{{ candidate.fullname }} {% if candidate.party %}({{ candidate.party|convert_political_party }}){% endif %}</h3>
                                    <h3 class="votepct">{{ candidate.votepct|percentage|floatformat:0 }}%{% if contest.contestid == 'sos-statewide-president' %}<br /> <span class="blurb-text">of california voters</span>{% endif %}</span></h3>
                                </div>
                            {% endfor %}
                            <h4>Source: {{ contest.resultsource }}</h4>
                        </div>
                    {% else %}
                        <div class="results-block measure-hack clearfix">
                            <header>
                                <h2 class="race-title">{{ contest.contestname|title }}</h2>
                                <h2 class="precincts-reporting">{{ contest.precinctsreportingpct|percentage|floatformat:0 }}% precincts reporting</h2>
                            </header>
                            {% for this in contest.ballotmeasure_set.all %}
                                <div class="result-item dashboard-hack clearfix">
                                    <h3 class="candidate-name">Yes</h3>
                                    <h3 class="votepct">{{ this.yespct|percentage|floatformat:0 }}%</h3>
                                    <h3 class="candidate-name">No</h3>
                                    <h3 class="votepct">{{ this.nopct|percentage|floatformat:0 }}%</h3>
                                </div>
                            {% endfor %}
                            <h4>Source: {{ contest.resultsource }}</h4>
                        </div>
                    {% endif %}
                {% endfor %}
            {% endfor %}
        </div>
    </div>
{% endblock %}
